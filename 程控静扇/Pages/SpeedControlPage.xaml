<Page
    x:Class="程控静扇.Pages.SpeedControlPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:程控静扇.Pages"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:程控静扇.ViewModels"
    xmlns:converters="using:程控静扇.Converters"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    xmlns:helpers="using:程控静扇.Helpers"
    xmlns:foundation="using:Windows.Foundation"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <converters:HealthToBrushConverter x:Key="HealthToBrushConverter"/>
        <converters:AxisArrayToEnumerableConverter x:Key="AxisArrayConverter"/>
        <converters:IpmiStatusToBrushConverter x:Key="IpmiStatusToBrushConverter"/>
    </Page.Resources>

    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="0,0,0,20" Background="#414141" BorderBrush="DarkGray" BorderThickness="0,0,0,1" Padding="0,10,0,10">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="10,0,0,0">
                <Image Source="ms-appx:///Assets/icon.png" Width="24" Height="24" Margin="10,0,0,0"/>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0,0,0">
                    <TextBlock x:Uid="AppTitle_Server" Text="服务器 " Foreground="White" FontSize="20" Margin="10,0,10,0"/>
                    <TextBlock x:Uid="AppTitle_ThermalManager" Text="热管理器" Foreground="#CD5C5C" FontSize="20" FontWeight="Bold" Margin="0,0,0,0"/>
                    <TextBlock x:Uid="AppTitle_ProgrammedFanTweaker" Text="「程控静扇」" Foreground="White" FontSize="20" FontWeight="Normal" HorizontalAlignment="Right"/>
                </StackPanel>
            </StackPanel>
            <TextBlock Text="{x:Bind Version, Mode=OneWay}" VerticalAlignment="Bottom" HorizontalAlignment="Right" FontSize="12" Margin="0,0,10,0"/>
        </Grid>

        <Grid Grid.Row="1" ColumnSpacing="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Main Controls -->
            <StackPanel Grid.Column="0" Spacing="10">
                <Grid x:Name="ConnectionSettingsPanel" ColumnSpacing="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Icon Column -->
                    <FontIcon Grid.Column="0" Grid.RowSpan="3" Glyph="&#xE7EE;" FontSize="96" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="0,0,20,0"
                              Foreground="{x:Bind StatusServiceInstance.IpmiStatus, Mode=OneWay, Converter={StaticResource IpmiStatusToBrushConverter}}">
                        <FontIcon.RenderTransform>
                            <RotateTransform Angle="0"/>
                        </FontIcon.RenderTransform>
                        <FontIcon.RenderTransformOrigin>0.5,0.5</FontIcon.RenderTransformOrigin>
                    </FontIcon>

                    <!-- Input Fields Column -->
                    <StackPanel Grid.Column="1" Spacing="5" Grid.Row="0">
                        <TextBlock x:Uid="IDRAC_IP_Label" Text="iDRAC IP:"/>
                        <TextBox x:Name="IpAddressTextBox" Text="169.254.0.1" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="输入iDRAC设备的IP地址，用于建立连接。"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Spacing="5" Grid.Row="1" Margin="0,5,0,0">
                        <TextBlock x:Uid="Username_Label" Text="Username:"/>
                        <TextBox x:Name="UsernameTextBox" Text="root" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="输入iDRAC设备的用户名。"/>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Spacing="5" Grid.Row="2" Margin="0,5,0,0">
                        <TextBlock x:Uid="Password_Label" Text="Password:"/>
                        <PasswordBox x:Name="PasswordBox" Password="calvin" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="输入iDRAC设备的密码。"/>
                    </StackPanel>
                </Grid>

                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,10,0,0">
                    <Button x:Name="SetManualButton" x:Uid="SetManual_Button" Content="Set Manual Speed" Click="SetManualButton_Click" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="点击此按钮将风扇控制设置为手动模式。"/>
                    <Button x:Name="SetAutoButton" x:Uid="SetAuto_Button" Content="Enable Automatic Control" Click="SetAutoButton_Click" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="点击此按钮启用风扇自动控制模式。"/>
                    <Button x:Name="GetStatusButton" x:Uid="GetStatus_Button" Content="Get Sensor Status" Click="GetStatusButton_Click" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="点击此按钮获取风扇和传感器状态信息。"/>
                </StackPanel>

                <InfoBar x:Name="EmergencyInfoBar" IsOpen="{x:Bind StatusServiceInstance.IsEmergencyControlActive, Mode=OneWay}" Severity="Warning" Title="自动风扇控制已启动" Message="CPU温度过高，风扇转速已自动提升。" Margin="0,10,0,0"/>
                <InfoBar x:Name="CooldownInfoBar" Severity="Success" IsClosable="True" Margin="0,10,0,0"/>

                <Grid Margin="0,10,0,0">
                    <ProgressBar Value="{x:Bind EFCService.BoostedFanSpeed, Mode=OneWay}" Maximum="100" Height="4" VerticalAlignment="Center" Foreground="#CD5C5C"  Margin="0,24,0,0"/>
                    <Slider x:Name="FanSpeedSlider" Minimum="0" Maximum="100" ValueChanged="FanSpeedSlider_ValueChanged"
                            x:Uid="FanSpeed_Slider" Header="Fan Speed (%)" Orientation="Horizontal" VerticalAlignment="Center" PointerEntered="OnPointerEntered" PointerExited="OnPointerExited" Tag="拖动滑块调整风扇转速百分比。"/>
                </Grid>

                <StackPanel Margin="0,10,0,0">
                    <TextBlock Text="风扇状态" HorizontalAlignment="Center" Style="{ThemeResource SubtitleTextBlockStyle}"/>
                    <TextBlock x:Name="FanStatusMessageTextBlock" HorizontalAlignment="Center" Margin="0,5,0,0" Visibility="Collapsed"/>
                    <ItemsControl ItemsSource="{x:Bind FanStatuses}" MaxWidth="200" HorizontalAlignment="Center">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="vm:FanStatusViewModel">
                                <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="10" Margin="0,2">
                                    <Ellipse Width="10" Height="10" VerticalAlignment="Center" Fill="{x:Bind Health, Converter={StaticResource HealthToBrushConverter}}"/>
                                    <TextBlock Grid.Column="1" Text="{x:Bind Name}" FontWeight="Bold"/>
                                    <TextBlock Grid.Column="2" Text="{x:Bind Rpm}" TextAlignment="Right"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>

                <InfoBar x:Name="InfoBar" IsOpen="False" Severity="Informational" Margin="0,10,0,0"/>
            </StackPanel>

            <lvc:CartesianChart
                x:Name="TemperatureChart"
                Grid.Column="1"
                Height="300"
                VerticalAlignment="Top"
                Series="{x:Bind Series}"
                XAxes="{x:Bind XAxes, Converter={StaticResource AxisArrayConverter}}"
                YAxes="{x:Bind YAxes, Converter={StaticResource AxisArrayConverter}}"
                >
            </lvc:CartesianChart>

            <!-- SVG Image -->
            <Image x:Name="ServerLayoutImage" Stretch="Uniform"
                   Grid.Column="1"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Width="400" Height="300"
                   Margin="0,0,20,20"/>

        </Grid>

        
    </Grid>
</Page>