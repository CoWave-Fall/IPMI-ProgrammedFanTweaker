 <Window x:Class="程控静扇.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:程控静扇"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:services="using:程控静扇.Services"
    xmlns:converters="using:程控静扇.Converters"
    mc:Ignorable="d"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    xmlns:tb="using:H.NotifyIcon">

    <Window.SystemBackdrop>
        <MicaBackdrop  Kind="BaseAlt"/>
    </Window.SystemBackdrop>

    <Grid>
        <Grid.Resources>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- For AppTitleBar -->
            <RowDefinition Height="*"/> <!-- For NavigationView -->
            <RowDefinition Height="Auto"/> <!-- For Border (Status Bar) -->
        </Grid.RowDefinitions>

        <!-- App Title Bar -->
        <Grid x:Name="AppTitleBar" Grid.Row="0" Background="Transparent" Height="32" VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Image Source="ms-appx:///Assets/icon.ico" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="8,0,0,0" Width="16" Height="16"/>
            <TextBlock x:Uid="AppDisplayName" Text="程控静扇服务器热管理器" VerticalAlignment="Center" Margin="30,0,0,0" Style="{ThemeResource CaptionTextBlockStyle}"/>
        </Grid>

        <tb:TaskbarIcon 
            x:Name="MyNotifyIcon"
            IconSource="ms-appx:///Assets/icon.ico"
            ToolTipText="程控静扇"
            DoubleClickCommand="{Binding ShowWindowCommand}"
            LeftClickCommand="{Binding ShowWindowCommand}">
            <tb:TaskbarIcon.ContextFlyout>
                <MenuFlyout>
                    <MenuFlyoutItem Text="显示/隐藏" Command="{Binding ShowWindowCommand}"/>
                    <MenuFlyoutItem Text="退出" Command="{Binding ExitApplicationCommand}"/>
                </MenuFlyout>
            </tb:TaskbarIcon.ContextFlyout>
        </tb:TaskbarIcon>

        <NavigationView x:Name="NavView"
                        Grid.Row="1"
                        IsBackButtonVisible="Collapsed"
                        IsSettingsVisible="False"
                        Loaded="NavView_Loaded"
                        ItemInvoked="NavView_ItemInvoked"
                        OpenPaneLength="200"
                        PaneDisplayMode="Left">
            <NavigationView.MenuItems>
                <NavigationViewItem x:Uid="Nav_SpeedControl" Content="Speed Control" Tag="SpeedControlPage" PointerEntered="NavigationViewItem_PointerEntered" PointerExited="NavigationViewItem_PointerExited">
                    <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE94A;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem x:Uid="Nav_Settings" Content="Settings" Tag="SettingsPage" PointerEntered="NavigationViewItem_PointerEntered" PointerExited="NavigationViewItem_PointerExited">
                     <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE713;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem x:Uid="Nav_About" Content="About" Tag="AboutPage" PointerEntered="NavigationViewItem_PointerEntered" PointerExited="NavigationViewItem_PointerExited">
                     <NavigationViewItem.Icon>
                        <FontIcon Glyph="&#xE946;"/>
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
                <NavigationViewItem x:Uid="Nav_Log" Content="Log" Tag="LogPage" PointerEntered="NavigationViewItem_PointerEntered" PointerExited="NavigationViewItem_PointerExited">
                     <NavigationViewItem.Icon>
                     <FontIcon Glyph="&#xE8DF;"/> <!-- Example: Document icon -->
                    </NavigationViewItem.Icon>
                </NavigationViewItem>
        </NavigationView.MenuItems>

            <Frame x:Name="ContentFrame" Navigated="ContentFrame_Navigated"/>
        </NavigationView>

        <Border Grid.Row="2" BorderThickness="0,1,0,0" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
            <Grid>
                <!-- Emergency Status -->
                <StackPanel x:Name="EmergencyStatusPanel" Orientation="Horizontal" HorizontalAlignment="Right" Visibility="Collapsed" Margin="0,5,10,5">
                    <ProgressRing IsActive="True" Width="16" Height="16" Margin="5,0,10,0" VerticalAlignment="Center"/>
                    <TextBlock Text="正在尝试控制CPU温度" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Normal Status -->
                <StackPanel x:Name="NormalStatusPanel" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock x:Name="StatusTextBlock" Text="" Margin="10,5" VerticalAlignment="Center"/>
                    <ProgressRing x:Name="StatusProgressRing" IsActive="False" Width="16" Height="16" Margin="5,0,10,0" VerticalAlignment="Center" Visibility="Collapsed"/>
                    <FontIcon x:Name="StatusSymbolIcon" FontSize="16" Margin="5,0,10,0" VerticalAlignment="Center" FontFamily="Segoe MDL2 Assets" Foreground="LightGray" Visibility="Visible"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>